<h1>
    Инструкция по созданию индивидуальных шаблонов документов для OneBox
</h1>

<h2>
    Типы шаблонов документов
</h2>

Всего бывает три типа документов:

<ul>
    <li>К заказу - выписывается на основе заказа. В документ могут быть переданы переменные и поля заказа, контакта,
        менеджера, юридического лица и так далее. Фактически всего, к чему можно добраться от конкретного заказа.
    </li>
    <li>К контакту (пользователю) - выписывается на основе контакта (пользователя).
    </li>
    <li>К складской операции - выписывается на основе УЖЕ СОСТОЯВШЕЙСЯ складской операции. Например, переместили что-то
        между складами - можно выписать документ “Накладная перемещения”.
    </li>
</ul>

<h2>Какие шаблоны есть по умолчанию в OneBox:</h2>
<ul>
    <li>Для заказов: Счет-фактура, акт выполненных работ, накладная заказа.
    </li>
    <li>Для контакта: никакие.
    </li>
    <li>Для складской операции: Накладная перемещения.
    </li>
</ul>

<h2>
    Чем фактически являтся шаблон документа?
</h2>

<p>
    Это обычная HTML-страница, которая оптимизирована для печати на листах А4.
</p>

При верстке документов необходимо учитывать следующие требования:
<ul>
    <li>Вся верстка выполняется в одном файле, CSS стили должны описываться в HEAD-е документа.</li>
    <li>Если в документе используются изображения, их необходимо загрузить на сервер и в документе обозначить соответствующие пути.</li>
    <li>Нельзя использовать свойство float для выравнивание блоков, вместо него используем верстку с помощью table и выравниванием внутри ячейки.</li>
    <li>Нельзя использовать свойство background-image, вместо него используем верстку с помощью img.</li>
    <li>Нельзя использовать абсолютное позиционирование обьектов, вместо него используем верстку с помощью table и выравниванием внутри ячейки.</li>
    <li>Для принудительного разрыва страницы необходимо использовать свойство page-break-after: always.</li>
    <li>По умолчанию необходимо использовать шрифт Arial 16px, если это позволяет макет документа.</li>
    <li>Так же стоит обратить внимание на то, что печать документов в разных браузерах происходит по разному.</li>
</ul>

<h2>Как создать индивидуальный шаблон?</h2>
Когда клиент просит создать для него индивидуальный шаблон документа (custom-шаблон), то задача делися на три части:
<ol>
    <li>Менеджеру проекта: понять к чему относится документ: заказу, пользователю или складу. Понять, какие поля будут
        передаваться из заказа/пользователя/склада, а какие будут вводиться руками (custom-поля). Поставить задачу на
        верстальщиков, где обязательно указать эти данные.
    </li>
    <li>Верстальщик верстает шаблон документа согласно правил и проверяет, чтобы документ помещался на экран и отлично ложился при печати на листах формата А4
        горизонтально или вертикально (зависит от документа).
    </li>
    <li>Верстальщик выполняет натяжку документа и прикрепление его как шаблона к box’y клиента.
    </li>
</ol>

<p>
    Кстати, создавать новые шаблоны можно прямо из-под модулей вызвав, этот метод:
</p>
<br/>

<code>
    <pre>
DocumentService::Get()->addDocumentTempalte($name, $content, $type, $key, $hidden, $required, $period, $sort, $numberprocessor)
    </pre>
</code>
<br/>
<p>
Где:
</p>
<br/>
<code>
    <pre>
$name - имя нового документа
$content - шаблон документа, или же путь к html файлу шаблона, к примеру: 'file:/modules/document/... .html';  
$type - к чему относится шаблон, по-умолчанию - это 'ShopOrder',
также, есть возможность  'User' и 'ShopStorageTransaction';
$key - ключ документа
$hidden(false) - скрытый документ, по умолчанию отображаемый(не обязательное поле);
$required(false) - отображаемый документ (не обязательное поле);
$period(false) - срок действия документа в днях (не обязательное поле);
$sort(false)- порядок сортировки(не обязательное поле);
$numberprocessor(false) - программный обработчик нумерации (не обязательное поле); 
    </pre>
</code>
<br/>

<h2>
    Как правильно делать натяжку?
</h2>

Натяжка подразумевает:
<ol>
    <li>расстановку переменных документа внутри шаблона.
    </li>
    <li>проверку, чтобы все поля передавались правильно.
    </li>
    <li>создание записи document templates (в меню OneBox это “Шаблоны документов”)
    </li>
    <li>проверка, чтобы документ выписывался из заказа/контакта/склада.
    </li>
</ol>
<br/>

<p>
    Чтобы понять, какие переменные передаются в шаблон есть два способа:
    <br/>
    1. Посмотреть уже существующий шаблон (например, счет-фактуру для заказа).
    <br/>
    2. Запустить скрипт php -f modules/document/tools/tool-document-fields.php с параметрами тип и ID.
    <br/>
    Например:
</p>
<br/>

<code>
    <pre>
php -f modules/document/tools/tool-document-fields.php user 100
php -f modules/document/tools/tool-document-fields.php order 200
php -f modules/document/tools/tool-document-fields.php storage 300
    </pre>
</code>
<br/>

<p>
    первый параметр - это тип.
    <br/>
    второй параметр - это ID объекта.
</p>
<br/>

<p>
    Если вводите order 100 - то система находит в OneBox заказ №100 (или задачу или проект) и на основе этого заказа
    показывает вам на экран все переменные, которые будут переданы в такой шаблон (print_r).
</p>
<br/>

<p style="color: red;">
    Внимание! Старайтесь прописывать все переменные по максимуму!
    <br/>
    Внимание! Если какой-то нужной переменной не хватает или вы не можете ее найти - ставьте подзадачу на администратора
    производства, с описанием какой переменной вам не хватает.
</p>
<br/>

<h2>
    Заполняемые поля
</h2>

<p>
    Шаблоны документов поддерживают заполняемые поля.
    <br />

    Это работает так: уже ПОСЛЕ того как документ на основе шаблона
    выписан, то на странице редактирования документа будут часть полей, в которые можно что-то вписать и сохранить.
    Чтобы прописать такое поле, нужно внутри HTML-кода документа ЛЮБУЮ фразу заключить в квадратные скобки.
    <br/>
    <br/>

    Например:
    <br/>
    бла бла бла [Фамилия Имя Отчество Клиента] бла бла бла
    И на этом месте появится input text, с placeholder=“Фамилия Имя Отчество Клиента"
</p>
<br/>

<h2>
    Как дебажить документы?
</h2>

<p>
    Так как все время загружать код в documenttemplates и выписывать документ не удобно, то в процессе натяжки мы
    рекомендуем:
    <br/>
    1. Записываете свой документ в какой-то файл tmp.html
    <br/>
    2. Открываете в браузере ссылку /admin/document/debug/
    <br/>
    3. Выбираете тип шаблона, вводите ID заказа/контакта/склада, вводите путь к вашему файлу tmp.html на сервере и жмете
    кнопку Просмотреть. Ниже загружается документ каким он будет.
</p>
<br/>