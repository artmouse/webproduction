<h1>
    Интеграция OneBox и SMTP
</h1>

<p>
    Все письма в OneBox отправляются через метод sendEmail() в UserService. Все что он делает - это берет письмо и
    складывает его в таблицу mailutils_que. Затем cron-minute достает эти письма из таблицы, отправляет их и помечает
    как отправленные (реже чистит) в таблице mailtuils_que.
</p>
<br/>

<p>
    Но, нюанс в том, что есть много способов доставки писем из таблицы mailutils_que до конечного адресата.
</p>
<br/>

<p>
    По умолчанию этот способ - функция mail().
    <br/>
    Ее недостаток в том, что она отправляет письмо с неправильными загловками. Такие письма доходят до получателя, но в
    50% случаев будут помечены как спам.
</p>
<br/>

<p>
    Чтобы избежать попадания писем в спам - нужно отправлять письмо через настоящий SMTP. Например, нужно отправить
    письмо от ящика max@webproduction.ua на ящик xxx@mail.ru, значит нужно подключиться к SMTP max@webproduction.ua и
    заставить его отправить это письмо.
</p>
<br/>

<p>
    OneBox умеет это делать, но для этого необходимо прописать настройки интеграции с SMTP.
    <br/>
    Это можно сделать двумя способами:
</p>
<ul>
    <li>
        автоматический. По умолчанию OneBox будет пытаться использовать настройки подключения IMAP парсера, и если
        нужного
        ящика не будет - будет использована функция mail(). Эта логика описана в классе Box_SenderMail, который является
        отправщиком почты по умолчанию.
    </li>
    <li>
        ручной способ для одного конкретного ящика. Например, если все письма вы шлете с обратным адресом sales@, то
        можно
        прямо в engine.mode.php указать через какой SMTP идут эти письма. Для этого укажите оптравщик писем:
    </li>
</ul>

<code>
    <pre>
Engine::Get()->setConfigField('mail-sender', 'MailUtils_MySender’);
или
Engine::Get()->setConfigField('mail-sender', new MailUtils_MySender(...));
    </pre>
</code>
<br/>

<p>
    Как проверить что все работает?
    <br/>
    Напишите осмысленное письмо из OneBox. Например, из задачи или через окошко “Написать письмо”.
    <br/>
    Запустите cron minute. Если не получилось подключиться к SMTP - там будут ошибки.
    Через 2-5 минут письмо должно быть доставлено.
</p>
<br/>

<p>
    Важно: если вы пишете письмо типа 11112222333 и отправляете на gmail.com, mail.ru, ukr.net - не факт что это письмо
    дойдет вообще. Сейчас почтовые сервера хорошо понимают что это белиберда или спам даже просто по содержимому
    письма.
</p>