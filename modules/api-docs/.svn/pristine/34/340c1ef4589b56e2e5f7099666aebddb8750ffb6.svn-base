<h1>
    Интеграция OneBox и телефонии - оригинация звонков
</h1>

<p>
    Originate (оригинация, реже называют инициация звонков) - это команда в современных системах телефонии по
    автоматическому соединению двух абонентов.
</p>
<br/>

<p>
    Обычно это работает так:
    <br/>
    100 originate 200
    <br/>
    Абонент 100 будет звонить абоненту 200.
    <br/>
    После выполнения команды, сначала звонит телефон 100, как только поднять трубку - телефон 100 будет звонить на
    телефон 200.
</p>
<br/>

<p>
    OneBox поддерживает оригинацию для asterisk и для binotel (про это подробнее в модуле binotel).
</p>
<br/>

<p>
    В Asterisk оригинация выполняется через протокол AMI (об этом была задача в стажировке).
</p>
<br/>

<p>
    Чтобы включить интеграцию AMI в OneBox нужно из module/box/example.engine.mode.php взять строки, которые отвечают за
    настройку AMI и прописать их в engine.mode.php
</p>

<br/>
<code>
    <pre>
    $a = array();
    $a['host'] = 'repka.webproduction.ua';
    $a['port'] = 5038;
    $a['login'] = 'webproduction-ami';
    $a['password'] = ‘xxxxxx';
    Engine::Get()->setConfigField('asterisk-ami', $a);

    // контексты входящих и исходящих звонков для Asterisk AMI
    // по умолчанию office-calls и outgoing-calls
    Engine::Get()->setConfigField('asterisk-ami-context-in', 'yazz-calls');
    Engine::Get()->setConfigField('asterisk-ami-context-out', 'yazz-outgoing-calls’);
    </pre>
</code>
<br/>

<h2>
    Что сделать после настройки и как это проверить?
</h2>

<p>
    Прописываете в карточке своего юзера OneBox внутренний номер телефона
    в OneBox жмете на любой номер телефона (не свой) чтобы позвонить.
</p>
<br/>

<p>
    Наиболее частые проблемы, которые возникают:
</p>
<ul>
    <li>
        куда подключаться или “нас забанили”. Бывает, что за частые подключения к серверу нас банят. Нужно просить
        админа сервера, чтобы открыл доступ для такого-то IP навечно.
    </li>

    <li>
        не понятно что такое контексты и что туда прописывать. Это может дать вам ТОЛЬКО администратор, который
        настраивал asterisk.
    </li>

    <li>
        если не прописать контексты или прописать не верные - то система не будет звонить.
    </li>

    <li>
        как понять, какую ошибку выдает asterisk при звонке? Включите режим debug в engine.mode.php и жмите на номер
        телефона в карточке контакта (чтобы позвонить). В консоль маузера будет написана ошибка.
    </li>

    <li>
        не звонит, ошибок не выдает. В таком случае возможно ваш IP телефон отключен, у него отпал интернет или он стоит
        в режиме “Не беспокоить”.
    </li>

    <li>
        при оригинал раздается звонок, но в трубке отвечает робот. Тут всего два варианта - либо неверные контексты,
        либо asterisk не правильно понимает формат номера. В любом случае помочь может только админ истерика.
    </li>

    <li>
        звонит, но говорит что номер неверный. Скорее всего номер, на который вы пытаетесь позвонить записан не в полном
        формате. Надо 380501111111, а у вас например 0501111111.
    </li>
</ul>